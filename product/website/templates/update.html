<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="stylesheet" href="/static/style.css" type="text/css" media="screen" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js">
            $.ajax({
                url:'/play',
                cache: false
            })
        </script>
        <title>Walltag</title>
    </head>
    <body>
        <div class="container">
            <ul>
                <li><a href="/">Home</a></li>
                <li><a class="active" href="update">Game</a></li>
                <li><a href="#about">About</a></li>
                <li><img id="photo" src="/static/logo.png" /></li>
            </ul>
            <h2>Walltag</h2>
            <div id="gegevens">
                <p id="Name">Name: </p>
                <p id="Lives">Lives: </p>
                <p id="points">Score: </p>
                <p id="lastLine">  </p>
            </div>
            <script>
                var countdown = 3;
                var points = 0;
                var Lives;
                var Status;
                var repeat;
                var statloop;
               $.get("/get_data", function(response){
                   Lives = response.playerLives;
                   $('#Name').text("Name: "+response.playerName),
                   $('#Lives').text("Lives: "+ Lives),
                   'json'})


               function getStat() {
                   document.getElementById("lastLine").innerText = "Schiet!!";
                   repeat = setInterval(function refresh() {
                        if (Lives > 0) {
                           $.get("/status", function (data) {
                               Status = Boolean(data.targetStatus);
                           })
                           if (Status) {
                               document.getElementById("lastLine").innerText = "RAAK!!";
                               clearInterval(repeat);
                           }
                       }
                   }, 500)
                   setTimeout(function(){clearInterval(repeat);
                       if (!Status){
                           document.getElementById("lastLine").innerText = "Helaas Mis!";
                       }
                       Loop();
                   },2000);
                   console.log("Status: " + Status);
               }

               function Quit(lastLog){
                    $.get("/quit");
                    lastLog;
               }

               function Start(firstLog) {
                   $.get("/start");
                   firstLog;
                   document.getElementById("points").innerText = "Punten: " + points;
                   setTimeout(getStat,3000);
               }

               function Loop() {
                   if (Lives > 0) {
                       if (Status) {
                           points += 1;
                           document.getElementById("points").innerHTML = "punten: " + points;
                       } else {
                           Lives -= 1;
                           document.getElementById("Lives").innerText = "Levens: " + Lives;
                       }
                       var timer = setInterval(function(){
                           if (countdown <= 0){
                               clearInterval(timer);
                               getStat();
                           } else {
                               document.getElementById("lastLine").innerText = countdown + "....";
                           }
                           countdown -=1;
                       },1000);
                   } else {
                       document.getElementById("lastLine").innerText = "Helaas, You Lost!";
                       clearTimeout(statloop);
                       Quit(console.log("game Quit"));
                   }
               }

               Start(console.log("game start"));
            </script>
        </div>
    </body>
</html>








